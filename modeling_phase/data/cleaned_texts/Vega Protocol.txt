vega protocol liquidity incentivising decentralised trading protocol smart financial products g danezis d hrycyszyn b mannerings george vega xyz dave vega xyz barney vega xyz t rudolph d ska si tamlyn vega xyz david vega xyz 3rd june 2019 published 4th september 2018 abstract majority existing financial markets exhibit key problems need trust parties high costs driven rent seeking intermediaries presence organisations structures act gatekeepers censors control availability products stifle innovation vega protocol decentralised trading execution financial products designed fully automated end end margin trading open public networks secured proof stake outline novel incentivisation scheme leverages dynamic liquidity marketplace solve problem attracting allocating market making resources permissionless innovation enabled smart products allow create products propose new markets works tandem decentralised risk management enable safe trading arbitrarily complex instruments products vega network reference practically underlying price data feed allowing participants define trade wide range instruments spectrum global markets cross chain settlement means protocol blockchain agnostic allows trades settle crypto asset residing supported chain paving way physically settled cash settled products commodity asset tokenisation widespread believe technology transformational financial system changing dynamics power forming wave change radically alter operation markets relationship society whitepaper provides initial summary certain technical business essentials underlying vega protocol document expected evolve time project proceeds vega team post modifications revisions updated drafts time time including creation tokens whilst network s based vega protocol vega networks operation document sets forth description vega protocol reference software implementation potential vega networks includes descriptions protocol smart products use tokens proposed vega token document provided information purposes binding legal agreement sale offering vega tokens governed separate terms conditions event conflict applicable terms conditions document terms conditions govern whitepaper offering document prospectus intended provide basis investment decision contract legal disclaimer date publication vega team plans launch public vega networks vega tokens proposed token known potential uses outside vega networks use intended document constitute advice recommendation vega team officers directors managers employees agents advisers consultants person recipient document merits purchasing acquiring holding vega tokens cryptocurrency token purchase holding cryptocurrencies tokens carries substantial risks involve special risks lead loss substantial portion money invested purchase tokens prepared lose entire allocated purchase vega tokens created available acquired speculative investment purposes expectation making profit immediate sale acquired fully understand intended functionality vega tokens intend use vega tokens purposes legal promises future utility performance value respect vega tokens including promise vega networks launched promise inherent value promise payments guarantee vega tokens hold particular value vega tokens designed structured sold securities vega tokens hold rights confer interests equity vega business future vega networks vega tokens designed intended future use public vega networks created vega protocol purposes trading governance transactions operation node proceeds sale vega tokens spent freely vega purpose including limited development business underlying technological infrastructure absent conditions set document whitepaper prospectus disclosure document offer sell solicitation offer buy investment financial instrument product jurisdiction treated relied distribution whitepaper complete document including cover page disclaimer accompanying boilerplate entirety information document forward looking speculative nature change response numerous outside forces including technological innovations regulatory factors currency fluctuations including limited market value cryptocurrencies whitepaper information purposes subject change vega team guarantee accuracy statements conclusions reached whitepaper vega team expressly disclaims representations warranties express implied statute whatsoever including limited representations warranties relating merchantability fitness particular purpose suitability wage title non infringement contents document accurate free errors contents infringe party rights vega business vega team operators vega networks shall liability damages kind arising use reference reliance contents whitepaper advised possibility damages arising whitepaper includes references party data industry publications vega team believes information reproduced whitepaper accurate estimates assumptions contained reasonable assurances accuracy completeness data information party sources contained obtained sources believed reliable assurances accuracy completeness included information data believed reliable vega team independently verified information data party sources referred whitepaper ascertained underlying assumptions relied sources note vega process undertaking legal regulatory analysis functionality protocol proposed vega tokens operation business following conclusion analysis vega team decide amend intended functionality vega tokens order ensure compliance legal regulatory requirements subject affect utility fungibility properties vega tokens vega tokens impacted regulatory action including potential restrictions ownership use possession tokens regulators competent authorities demand mechanics vega tokens altered entirely vega revise vega protocol vega token mechanics comply regulatory requirements governmental business obligations vega believes taken commercially reasonable steps ensure design vega tokens proper compliance currently considered regulations far reasonably possible regulatory authority examined approved information set whitepaper publication distribution dissemination whitepaper imply compliance applicable laws regulatory requirements entire document 2019 vega holdings ltd rights reserved contents 1 introduction 1 1 1 overviewofcorevegaconcepts 2 1 2 architecture ofapublicnetwork 3 2 background motivation 5 2 1 desirable properties decentralised trading protocol 5 2 2 realworld usesandadoption 6 2 3 summary 7 3 market framework 8 3 1 network 8 3 2 products 9 3 3 instruments 9 3 4 markets 10 3 5 riskuniverses 10 4 collateral management 11 4 1 acceptabletypesofcollateral 11 4 2 depositingandwithdrawingcollateral 11 4 3 allocationand releaseofcollateral 12 4 4 collateralmaintenancelevelsand margincalls 13 5 trading settlement 14 5 1 tradingmodes 15 5 2 settlement 16 5 3 positionresolution 16 6 network risk 18 6 1 creditrisk 18 6 2 liquidityrisk 21 6 3 extreme pricemoves 22 6 4 insurancepool 22 6 5 risksfromdecentralisationandproofofstake 23 6 6 marketmanipulationandgaming 24 7 liquidity 25 7 1 mechanicsoftheliquiditymarketplace 25 7 2 theroleofmarketmakers 26 7 3 dynamicliquiditypricing 27 8 decentralised governance 29 8 1 stake weightedvoting 29 8 2 marketcreation 29 8 3 marketclosure 30 8 4 parameterchanges 30 9 future work 31 glossary 32 references 35 vega protocol 1 introduction introduction vega technology protocol associated crypto asset 28 open blockchain backed public network fully automated end end trading execution financial products network secured proof stake implements pseudonymous margin trading novel liquidity incentivisation scheme based market forces solve problem attracting allocating market making resources decentralised system permissionless innovation enabled smart products allow create products propose new markets works tandem decentralised margin system suite risk models based coherent risk measures 5 enable safe trading arbitrarily complex instruments environment zero expected recovery event default products reference practically underlying price data feed allowing participants define trade wide range instruments spectrum global markets cross chain settlement means protocol blockchain agnostic allows trades settle crypto asset residing supported chain paving way physically settled1 addition cash settled products commodity asset tokenisation widespread paper describes protocol defines traders market makers node operators interact collectively run high performance fully decentralised markets deterministic way need human intervention includes robust market framework manages network markets participants provides strong foundation functionality vega protocol covers end end trading including price determination margining settlement collateral management chain market governance submitinstructioncancelinstructionnotifyobservableamendinstructionproposeopenmarketproposeparametervoteforproposalproposeclosemarketmarket pendingmarket openno marketmarket closedparameter changed new trade new trade position closedposition closedsettlement instructionnotifydepositvalidatewithdrawalrequestwithdrawalcollateraltradinggovernanceupdated balanceswithdrawal transaction figure 1 map core protocol transactions 1via settlement appropriate crypto asset represents claim real asset 1 vega protocol 1 introduction 1 1 overview core vega concepts vega opens decentralises markets fully automating processes incentives trading settling financial products pseudonymous participants requires carefully designed mechanisms economic rewards penalties protocol balances desire permissionless innovation need protect markets participants system described brief fully rest paper instruments defined combination product risk model required parameters traded open markets counter otc depending type instrument level market making support open markets created market makers match trades willing sufficiently collateralised participants otc trading occurs ad hoc basis trading modes include continuous trading limit order book discrete trading frequent batch auctions 19 request quote rfq smart products special type smart contract designed allow creation wide range financial products toolkit standard features economic primitives written higher level abstraction smart contracts making easier develop test better suited static analysis automated risk modelling smart product language details subject separate paper create new products designed settlement instructions risk calculations useful outputs trading2 derived single smart product definition collateral managed vega networks links blockchains3 funds deposited paying smart contract host chain collateral margin orders positions meaning required funds allocated market longer needed released allocated funds cant withdrawn trading markets withdrawals requested vega transaction successful results transaction host chain signed quorum vega nodes cause funds released requested destination address trading settlement designed fair predictable participants trading open markets use defined trading mode market conditions dictate example auction period identify fair price large moves protective measures required low liquidity positions settled continuously closed products generate interim cashflows finally expiry instrument collateral held margin released define position resolution algorithm fairly handle situations shortfall available collateral remaining funds markets insurance pool risk management particular importance pseudonymous trading practical recourse event participant owes allowed withdraw rightfully theirs mitigate trading margined risk models selected calibrated zero recovery rate environment margin requirements account slippage incurred closing position positions present unacceptably high risk loss network closed automatically rules designed average closeouts occur net positive margin remaining allocated position added insurance pool cover difference closeout leaves negative balance mechanic ensures markets network insurance pool balances redistributed markets expiry safer time liquidity provision incentivised protocol offline activity liquidity rewards distributed price makers trade market makers market proof stake token holders supporting infrastructure price takers incur fee point trade fee represents cost accessing liquidity level dynamically calculated according valuable liquidity market liquidity providers decide provide liquidity vega model effectively operates marketplace liquidity ultimate goal minimise cost trade efficiently 2for example legal contracts pricing models human readable descriptions 3the protocol create cryptocurrency trades settled existing coins tokens 2 vega protocol 1 introduction allocating market making resources key approach role market makers owneroperators markets involves committing provide order book depth return share liquidity value realised participants secured financial bond deposited network market governance necessary ensure network operate grow unencumbered manual intervention whilst minimising risk posed bad actors vegas market governance features designed concept stake weighted voting actions creation closure markets setting parameters influence behaviour main focus chain governance chain governance protocols ongoing development reference implementation scope paper covered detail later work 1 2 architecture public network vega protocol designed implemented distributed decentralised manner network nodes distinct trading parties participating markets nodes maintain mirror state vega network process transactions operate markets governance nodes included infrastructure proofof stake mechanism certain stake locked node surety operate correctly infrastructure nodes jointly run byzantine consensus protocol 6 ensures honest parties sequence operations consistently feed protocol implementation actions order network reference implementation currently uses4 tendermint distributed smart contracts platform consensus proof stake protocol clients connect infrastructure node send orders available market perform market actions participate governance network markets current reference node implementation includes rest api light clients able access platform graphql api web applications native grpc api interact infrastructure reference html based decentralised trading application connect local remote node clients participate network infrastructure node expect institutional actors including market makers use option infrastructure nodes sequenced actions consistently actions processed software implementing vega protocol nodes execute actions order protocol deterministic network arrives mirrored state orders trades collateral calculations governance decisions nodes define bridge platforms carrying cryptocurrencies tokens value vega protocol order trade assets native platforms integration ethereum blockchain ethereum smart contract allows users send assets ether erc20 tokens vega platform effectively locking holding account available collateral vega nodes read ethereum ledger transform locked assets collateral trading relevant markets trades settled clients choose withdraw assets inserting vega ledger withdrawal request transaction ethereum smart contract interprets transactions unlocks transfers assets receiving ethereum wallet simpler read bridges established vega oracles providing data feeds power certain markets oracles authenticated feeds data signed ensure integrity authenticity market combine data multiple similar oracles mitigate impact market given oracle fails malicious secure vega platform use mixture modern cryptography distributed systems security mechanisms user assets associated verification key digital signature algorithm public key actions relating assets transferring 4note run public network production blockchains vega protocol reference node software implementation designed capable supporting network 3 vega protocol 1 introduction placing orders amending cancelling orders governance decisions carry valid digital signature originating user considered valid determined automatically protocol rules e g closing overexposed positions properties modern byzantine consensus algorithms guarantee safety infrastructure nodes sequence client actions liveness system eventually perform client actions tendermint library currently use guarantees subject set nodes thirds stake honest 18 vega protocol enginenodenodenodewrite transactions pass consensusgossipgossipmarginpositionsgovernancesettlementpositionsconsensus layerordered transactionswithdrawalsdepositsmarketriskcollateralproductid authcollateral blockchain e g ethereum orderstradespositionswalletsmarketsall nodes guaranteed produce outputvega client api grpc rest graphql fix clients api consumers etc figure 2 logical architecture public vega network 4 vega protocol 2 background motivation 2 background motivation traditionally financial products created traded markets consisting organisations individuals connected technology systems contractual obligations simultaneously facilitate trading create barriers entry vary complexity cost sophistication extremely slow manual error prone paper based operations high speed high liquidity electronic markets regardless precise methods systems use markets exhibit key problems include need trust parties rent seeking intermediaries drive costs presence organisations structures act gatekeepers censors access existing markets equally importantly controlling availability products creation markets decentralised platform financial products individual node party compromised5 pose risk ongoing operation network availability markets provide genuine alternative allowing trade equal basis access available creation markets longer dependent central parties organisations 2 1 desirable properties decentralised trading protocol considering design approach vega find examining existing centralised decentralised solutions trading execution financial products markets varying size maturity identified key properties enumerated describe good trading platform good decentralised system fair trusted credible market operate way predictable comprehensible fair participants place money line trading platform dont trust work expected markets hold concepts trust fairness high regard decentralised solution important proposing system widen access greatly demonstrate proposal treats potential participants fairly predictably variety potentially hostile conditions constraints decentralisation ii liquid important trading venue sufficient liquidity available sustain grow market best achieved different mechanisms depending maturity size market new markets initially natural traders require commitment6 market makers provide liquidity opening kickstart growth relatively illiquid markets constant flow traders need strong incentives attract liquidity providers catalyse growth mature liquid markets interest market makers based volume benefit trading activity attracted low fees iii low latency general faster market react accurately price reflects available information whilst limits social utility decreasing latency important solution operates low latency traders disadvantaged compared trading venues iv high throughput provide fair trading venue wide appeal markets support trading needs participants possible system easily congested need randomly exclude participants create undesirably high cost barrier 5whether malicious actors bankruptcy consequence unanticipated situation 6traditionally provided sourced market operator centralised markets 5 vega protocol 2 background motivation trading7 furthermore important minimise chance external network conditions disrupting trading activities exemplified network slowdowns ethereum blockchain caused popular token sales trending dapps v scalable related throughput scalability important system supports needs individual market clear route supporting hundreds thousands markets particular practical interest ensuring underlying protocol design regardless constraints exist given implementation doesnt rely markets sharing global state resources instance requiring transactions write single blockchain vi flexible widely applicable work driven desire create common endto end infrastructure financial products usefulness system heavily dependent ability effectively support current future needs industries organisations societies interact global financial system design platform allows permissionless creation markets bespoke arbitrarily complex instruments ongoing evolution vii trust minimising order effectively deliver benefits decentralisation important minimise need participants identify pseudonymously trust creates requirements protect traders markets unrecoverable defaults prevent market creators liquidity providers position gain unfair advantage participants ensure participants overall net incentive malicious behaviour viii self governing previously discussed posit pseudonymous permissionless global trading network poses number risks kind usually mitigated strong centralised governance include limited potential fraudulent instruments fragmentation liquidity reputational damage unethical markets mitigate strong system decentralised governance required addresses risks jeopardising permissionless nature overall system ix product market independent given global nature decentralised network existence fundamental regional incompatibilities terms financial markets legislation important solution able act neutral infrastructure layer offer products operate markets responsibility legal compliance falling participants jurisdiction create products markets trade 2 2 real world uses adoption definition permissionless platform places development new products launching markets hands participants possible predict instruments available identified small subset use cases clear potential benefits idea potential technology traders blockchain cryptocurrency sector form obvious starting point given technical familiarity concepts underpinning vega existence active informed trading community significant growing trade volume increasing sophistication institutional interest means demonstrable demand decentralised platform trading crypto asset derivatives8 cost creating products operating markets previously prohibitive situations barriers access exist clear demand innovation met current system example 7this implicit need acquire computational resources network connectivity achieve access explicit including transactions offering highest fee 8examples include options futures derivatives crypto assets particularly allow traders market view previously difficult trade 6 vega protocol 2 background motivation relevant locally targeted insurance products instance providing unbanked underbanked agriculture compensation event catastrophic weather wider access reduced cost common hedging strategies offsetting fx risk small business owners overseas cost revenue sovereign credit default swaps cds settled cryptocurrency mitigating risk fiat devaluation event credit event fiat settled sovereign cds wider crypto economic ecosystem develops9 opportunity decentralised highly automated system replace costly slow error prone processes governing types business transactions agreements asset backed loans tokenised asset title automatically transferred event default borrower delivery vs payment industrial bulk goods services payment tied delivery proof ability apply penalties late delivery replication existing core banking insurance products providing lower execution costs better price discovery increased transparency finally decentralised financial products platform eventually attract trading away markets cheap liquid generally accessible fx equities migration trading activity longer term outcome predicated successful adoption markets wider industry trends including automation cost reduction increasing adoption blockchain technology general 2 3 summary work imagining functionality key economic mechanisms institutions light recent innovations decentralisation identified clear defined opportunity augment decentralised financial system taking cryptocurrencies tokenised sets relatively slow general purpose smart contracts adding high performance financial products trading execution layer platform imagine open door fairer accessible financial system doesnt favour groups exclude potential permissionless global markets improve things exist today fundamentally rethink harness tools economics drive better outcomes 27 conclude proposed platform small piece puzzle believe response centralisation inequality financial markets enabler experimentation future relationship money important excited introduce vega protocol 9for instance increasing availability maturity services like physical asset tokenisation blockchain based identity algorithmic asset backed stablecoins oracle services 7 vega protocol 3 market framework market framework satisfy need flexible self governing system section 2 1 vi viii vega provide standardised framework creating interacting markets rigid provide certainty users flexibly designed allow future expansion market product types trading modes additionally important core protocol simple predictable possible ensure implementations testable behaviour transactions reliably verified observer achieved hierarchical parametric framework describing markets figure 3 combined rules described document specify components interact transactions processed vega networkproductinstrumentrisk modeltradable instrumentrisk parametersproduct parameterstrading risk rulescreate closemarketmarket parameterssubmit amend cancel market instructioncollateralmarketnetwork parameterstrading protocolgovernance protocolcollateral protocoldeposit withdraw collateralupdate parameter figure 3 vegas hierarchical parametric market framework10 3 1 network conceptually level vega framework network encompasses markets products participants governance actions contained physical vega network section 1 2 potentially partitioned multiple shards achieve required scalability section 2 1 iv v network level governance transactions section 8 act number network parameters maintained collateral balances maintained network level 10note diagram focused interactions incoming transactions market framework transactions shown exhaustive 8 vega protocol 3 market framework 3 2 products product defines trades behave specifies calculate settlement cashflows section 5 2 contains metadata tell protocol product parameters source underlying data feed strike price maturity date exotic inputs required create instrument section 3 3 product products use external data price market event occurred form data vega markets special signed transactions pre approved outside parties known oracles productproduct parametersi e strike price maturity date identity oracle feedproduct logichard coded provided product definition risk model external product updated risk factors life instrumentproduct definitionoracle data feed s settlement cash flow s figure 4 flow data actions vega products products intentionally treated somewhat black box meaning protocol defines interaction points products components network interpret control functionality products respect considered domain specific smart contract products interact figure 4 directly protocol position settled indirectly associated risk model11 determines collateral section 4 allocated released risk universe section 3 5 given position primary advantage approach decouple product definition general protocol allowing significant evolution products market framework exemplified fact prototypes vega reference implementation use fixed number hard coded products protocol designed outset execution platform smart products type smart contract designed financial products allow vega complete host product market imaginable smart products constructed specially designed smart product language discussed upcoming paper published vega xyz 3 3 instruments instrument represents settled defined combination product section 3 2 required product parameters fully satisfy product e g option instrument consist product plus reference oracle underlying price strike price maturity date 8 p 151155 combination product parameters uniquely identifies instrument meaning instrument duplicated vega network12 instruments building blocks markets level markets de duplicated tradable 11note products contain risk models linked risk model understanding product calculating risk factors section 6 1 12although possible instrument considered redundant cause market creation vetoed product parameters closely match section 8 2 9 vega protocol 3 market framework tradable instrument complete instrument product parameters described combined validated risk model section 6 1 required risk parameters valid tradable instrument contains data needed vega execute trades calculate margin carry settlement complete validated tradable instrument required initiate trade managed vega protocol create market sort risk parametersproduct parametersinstrumentproductproducttradable instrumentinstrumentrisk modelimplementation black box figure 5 relationship products instruments tradable instruments 3 4 markets markets represent tradable instrument configured specific method trading market proposed active suspended closed depending instrument lifecycle risk management section 6 governance section 8 actions currently impacting trading markets specified market parameters include trading mode section 5 1 applicable parameters trading mode markets fall categories open markets suggests open sufficiently collateralised participant buy sell analogous public markets exist countries stocks foreign exchange asset classes generally trade limit order book k continuous trading modes discrete trading frequent batch auctions considered section 5 1 open markets require support market makers created approved networks governance process section 8 2 ensure risk model risk parameters set correctly new markets meet communitys standards ad hoc otc markets created needed participant wishes initiate trade price agreed offline vega protocol facilitate price discovery process instance rfq process trading modes covered detail section 5 1 items v vi 3 5 risk universes risk universe set markets sharing risk model risk parameters permit perfect netting margin markets partial netting achieved coherent risk measures section 6 1 allows efficient capital usage margins highly related product sets futures different maturities underlying asset given market member explicitly defined risk universe default specified market creation market said reside implied risk universe population addition new market existing risk universe carefully scrutinised creation process section 8 2 adding new market affect margin calculations 10 vega protocol 4 collateral management 4 collateral management trade settlement occurs crypto assets hosted blockchains ensure safe trading trust minimised environment trades public vega network need sufficiently collateralised order avoid closed section 6 1 collateral base currency settlement asset s need held managed decentralised fashion network protocol designed track balances participant basis e g public key wallet address arbitrarily large number crypto assets collateral management furthermore designed use simple deposit withdrawal protocol interface vega network crypto assets host chain allowing assets added relatively easily based demand performance deposits withdrawals given crypto asset dependent performance finality properties host chain deposited crypto asset transferred settled allocated released speed vega infrastructure regardless properties assets host chain 4 1 acceptable types collateral defining factor given asset vega networks ability manage certainty collateral held participant fungible digital asset13 following conditions hold true vega nodes digitally verify participants access asset ii placed indisputably sole control network iii irrevocably transferred participant network iv asset balances released network required practice requires system supports sufficiently powerful scripting smart contracts operate deposit address ability pay funds threshold k n authorisation scheme 1 currently assets meet requirements blockchain based cryptocurrencies digital tokens envision public implementation integrate ethereum blockchain smart contract capabilities existence 1500 erc20 tokens14 followed soon bitcoin dominant size 4 2 depositing withdrawing collateral collateral deposited placing vega networks control generally means paying wallet contract address released consensus agreement vega nodes method address collateral chain required nodes monitoring collateral chain post updates included network new notify deposit transactions figure 1 initially rejected majority nodes quorum reached observed new deposit participants request withdraw unallocated collateral vega time withdrawal transactions processed vega nodes signing approval rejection message case approval message contain payload signed transaction host blockchain collateral resides combining approval payloads supermajority nodes submitting collateral blockchain requester able complete withdrawal 13subject existence appropriate inter blockchain bridge cases non trivial 14which allows earlier experimentation innovation areas settlement tokenised assets multiasset settlement versus starting effectively single asset chain bitcoin 11 vega protocol 4 collateral management alicealice sends 100 eth vega smart contract100 eth sent alices walletrequest allocate 50 eth market a100 eth 100 available allocated100 eth 50 available 50 request allocate 25 eth market brelease notification 75 eth market a100 eth 25 available 50 25 b 125 eth 100 available 0 25 b 125 eth 0 available 25 b 100 withdrawrequest withdraw 100 eth alicenetwork approves25 eth 0 available 25 bethereumveganodes sign approvalnotification depositnotification successful payout figure 6 mechanics collateral deposit allocation withdrawal 4 3 allocation release collateral collateral required order trade allocated relevant risk universe unavailable use markets withdrawal risk universe trader active orders positions time time need allocate release collateral figure 6 figure 7 new order submitted insufficient collateral reserved cover participants updated worst case requirement position moves trader breaching configured collateral level unallocated collateral available position moves traders favour causing excessively high allocated margin case collateral released position fully partially closed collateral longer required depending architecture vega network question15 allocation release collateral able atomically single transaction collateral management handled locally require asynchronous request blockchain shard cost asynchronous collateral requests potential limitations place scalability collateral requests bottleneck trading distributed chains present biggest performance risks design vega protocol reduce latency impact trading scenario orders accepted optimistically network implement penalties deter attempted double spending collateral16 ideal solution throughput limit collateral requests known time 15particularly collateral managed blockchain risk universe requiring allocation release e vega network question implements sharding 16note possible short period p l newly opened position 0 12 vega protocol 4 collateral management writing area active research considered critical present problem early life vega network b acceptable ideal workaround exists form maintaining multiple balances asset class participant collateral transactions partitioned prior processing transaction requiring additional collateral allocation participants unallocated collateral checked minimum requirement process transaction margin calculations section 6 1 assuming initial check passed collateral reserved allocated risk universe transaction processed transaction rejected bobbob sends 100 eth vega smart contractrequest allocate 50 eth market a100 eth 100 available allocated100 eth 50 available 50 100 eth 50 available 50 100 withdrawrequest withdraw 100 eth bobnetwork rejects100 eth 50 available 50 aethereumveganodes reject requestno eth sentnotification deposit figure 7 example rejected collateral withdrawal request 4 4 collateral maintenance levels margin calls minimum collateral requirement maintain open position maintenance margin open orders initial margin calculated periodically table 9 section 6 1 describes collateral zones network tracks zone exceeding initial margin maintenance zone collateral search zone closeout zone initial margin required enter trade entering collateral search zone prompts collateral manager attempt allocate collateral particular risk universe attempting forestall forced closeout entering closeout zone prompts forced closeout positions remaining allocated collateral transferred risk universes insurance pool section 6 4 17 trader inform network position reaches collateral search level whilst unallocated collateral available network automatically attempt allocate additional collateral case position recapitalised automatically network possible recapitalisation configured possible position enter collateral search zone network action collateral zone reached unlike centralised markets margin calls performed client software algorithms party services issued network collateral levels margin calls responsibility trader set according trading strategy risk appetite 17open orders cancelled collateral penalty trader 13 vega protocol 5 trading settlement trading settlement decentralisation requires trading instructions like transactions executed deterministically nodes necessary ensure precisely results matching risk management settlement orders positions seen participant furthermore necessary node evaluate state market determine appropriate trading mode according applicable market parameters liquidity recent price history consequence requirement absolute determinism action18 markets including processing normal orders margin related closeouts responses risky price liquidity conditions completely automated end end manual intervention exceptions process unlike centralised market presents unique challenges fully automated trading settlement logic works market framework section 3 interprets data structures transactions determine state market given moment time workflow normal trading illustrated figure 8 protocols internal state includes order trade including closeouts price history market addition current state order book open positions margin requirements participant transparent publicly visible new trademarket trading modesubmit amend cancelmarket instructionpositionsupdateposition risk model calculatecloseout orders collateralallocate marginat maturity closed positionsettlementposition resolution update balances shortfallupdate balances pppcccp figure 8 fully automated trading settlement workflow 18aside small number governance actions section 8 involve participant voting occur extended time periods comparison market events 14 vega protocol 5 trading settlement 5 1 trading modes trading modes methods new trades generated designed liquid open market trading whilst facilitate otc markets bespoke illiquid instruments trading modes support multiple price determination methods precise discussion trading pricing algorithms scope document protocol agnostic specific implementation details trading modes set open markets market creation section 8 2 otc markets created ad hoc fashion trading mode defined needed following trading modes meet requirements flexibility fairness set section 2 1 cover needs open market ad hoc trading section 3 4 list includes protective modes required risk governance protocols section 6 section 8 respectively continuous trading operates decentralised version limit order books public private markets worldwide common configuration orders matched price time priority trades passive price order book alternative prioritisation schemes pricing algorithms implemented configurable market parameters ii discrete trading provides open market trading frequent batch auctions 19 originally designed response high frequency trading arms race frequent batch auctions suited blockchain environment transactions batched blocks mode core implements series short auctions price determination use pricing algorithm available auction period method shows interesting potential operating semi private decentralised markets stage process known commit reveal participants submit orders encrypted secret sharing 1 26 algorithm round submit portions decryption key set nodes network creates simultaneous reveal orders subsequent trade execution round ensuring participants run adjust prices based short term micro structural phenomena iii auctions standalone form create special type time market commonly open market normally uses trading method case market temporarily moved auction period expectation reverts normal trading mode auction concludes certain situations market creation section 8 2 market opens trading resumes suspension illiquidity section 6 2 find fair market price large price moves section 6 3 auction participants able submit amend cancel buy sell orders pre determined period time called auction period end given logical time network reaches consensus period price volume achieved auction end immediately given time known indicative uncrossing price indicative uncrossing volume participants way evolving trade price continuously traded market inform trading decisions period auction uncrossing occurs trades generated price range maximises total trading volume multiple potential price determination algorithms details outside scope paper iv suspended market occurs open market temporarily stopped trading protect market network types risk suspension resort system determined safe reasonable operate market current time example extremely low liquidity section 6 2 suspension operates like auction period defined end orders accepted book trades executed cases criteria lifting suspension 15 vega protocol 5 trading settlement linked depth orders suspension lifted achieved changing trading mode auction defined end time market return normal trading mode v request quote rfq trading bespoke illiquid instruments otc markets mode allows traders advertise interest trade instrument traders market makers free prices discretion quotes accepted result trades margined settled like quoted markets differ open markets risk models margin calculations require external data feeds mitigate lack liquid prices vi matched trades method participants directly submit trade managed vega network long parties submit compatible trade details given time window trade accepted managed like rfq driven trade 5 2 settlement settlement mechanism ensuring accounts traders credited debited correct collateral specific points trade lifecycle expiry instrument products valuation function section 3 2 passed required settlement data causing generate settlement instructions determine net asset flows trader open position settlement expiry positions closed collateral released prevent gaming settlement probabilistic nature time decentralised environment trading closed sufficiently prior expiry chance new transactions accepted settlemen data available ii interim cashflows generated product collateral positions updated reflect cashflows margin requirements recalculated based updated collateral position market data iii closing position entering counter trade including trade created forced risk management closeout closeout cashflow calculated difference opening closing price position closing price volume weighted average price vwap closing trades opening price vwap oldest volume closed total size closed event shortfall participant collateral cover required cashflows position resolution algorithm section 5 3 resolve situation fairly deterministically 5 3 position resolution traders liabilities market comprised outstanding settlement cashflows plus required margin active orders open positions found greater available collateral position called distressed position resolution algorithm invoked unwind obligations market distressed positions potentially unstable situation essentially randomly selected counterparties19 experience large losses warning solve problem designing vega reality trades trades decentralised network acting intermediary pool funds available 19given open markets pseudonymous possible traders selective identity creditworthiness counterparties 16 vega protocol 5 trading settlement market limited total collateral allocated risk universe section 3 5 markets insurance pool protect network contagion markets position resolution algorithm defined attempts ensure distressed positions closed fairly deterministically minimise risk excessive impacts individual participant defaulting trader protect market far possible volatile illiquid situations algorithm based key principles credit events impact market individual counterparties distressed positions threaten markets entire vega network event uncovered shortfall exhausting available collateral insurance pool section 6 4 contributions profitable traders based linearly profitability position resolution algorithm position resolution required evaluate outstanding settlement instructions ensure distressed positions identified following process executed order 1 open orders cancelled oldest participants remaining distressed positions point closing open orders lose collateral allocated risk universe regardless remaining balance closeout trades 2 net closeout volume ncv calculated ncv long closeout volume short closeout volume long closeout volume short closeout volume sum volume distressed long positions distressed short positions respectively 3 market order placed absolute net closeout volume ncv 0 order sell ncv 0 ncv 0 buy order placed 4 shortfall settlement cashflows closeout trades traders available collateral paid insurance pool remaining collateral settling closeout trade transferred insurance pool 5 event insurance pools section 6 4 collateral exhausted unpaid settlement cashflows outstanding final remaining shortfall contributions market participants profitable open positions relative contribution trader holding open position takes account relative unrealised profitability size open position note process market protection measures protect excessive price moves low liquidity remain effect result market suspended entering price discovery auction closeout process completes 17 vega protocol 6 network risk 6 network risk risk management complex topic certainly large justice paper evolve protocol ecosystem section considered critical risks particularly definitively addressed day rules trading protocol forms gaming manipulation unfair advantage arise public network running vega protocol far important risk consideration pseudonymous environment credit risk given expectation recourse event counterparty walking away losses given chance define rules detect dangerous market conditions apply protective measures discuss theoretical strategies malicious actor use attempt extract unfair value vega network deny service participants recognise huge scope implications topic need work dedicated significant resources areas risk details additional research papers latest updates published vega xyz 6 1 credit risk primary financial risk facing vega network credit risk platform counterparties identified public key recourse event trader owes settlement posted collateral essential protocol designed constantly maintain effective collateralisation positions property cryptocurrencies decentralised systems general leads design vega collateralised margined leveraged20 platform margin calculations taking account probability liquidation value position falling short available capital inability assume creditworthiness whatsoever participants serves push margin requirements somewhat mitigated ability network evaluate risk frequently pre emptively close positions margin risk assessed risk universe section 3 5 comprised single instrument collection instruments provide collateral offsets risk arising traders net liabilities exceeds minimum required margin position resolution algorithm section 5 3 settle distressed position approach risk modelling margin calculations performed net riskiest composition traders open positions live orders assuming scenario orders successfully executed resultant worst case hypothetical position referred liable position risk calculation purposes products value known time traded value equal price trade executed maturity intervening time use stochastic risk model provide reasonable estimate value provided risk neutral pricing 22 13 25 known example model blackscholes model21 universe models institutions different products general models provide simple formulae calculating derivative prices risk instead monte carlo simulation methods pricing general introduction e g 9 problem nested simulation arising specifically risk calculations 20 20when appropriate vega support collateralisation profit loss ceilings suitable risk model exists calculate safe margin level given instrument 21this model known capture essential market features superseded advanced ones easy calibrate provides closed form formulae prices 18 vega protocol 6 network risk vega requires development variety appropriate risk models allow margined trading widest possible range tradable instruments satisfy following requirements calculations transparent possible trader maintain manageable pace change margin requirements ii models robust theoretically sound support leveraged trading iii netting supported products asset classes unrealised gains market offset margin requirements note certain types products reasonable risk model capture liabilities case margin set liable position precludes leveraged trading protects network participants margin calculation mind vega use following methodology margin calculations maintenance margin level mmaintenance unit traded product determined mmaintenance net closeout p l market observable risk factor 1 net closeout p l volume weighted seen order book price trade required close traders position minus trade price price relevant trade entered 22 market observable value directly seen market example futures simply current price futures trading options current price underlying risk factor number calculated appropriate stochastic risk model different long short positions appropriate stochastic risk model risk factor reflect entire liability market observable set 1 risk factor remain relatively stable lifetime product changes minimum margin requirement explained trader considering net closeout p l moves market observable ensures margin calculations meet key requirement enhanced applying additional padding effective risk factor traders order reduce frequency margin requirements change independent market moves allow advance warning changes meet remaining requirements turn established theory coherent risk measures trader liable positions value x calculated risk model future time t 0 corresponding liability x margin reflect risk inherent liability vega use appropriate coherent risk measure calculate required margin mathematically risk measure function r assigns real number risk random variable portfolio risk measure called coherent satisfy following properties 12 monotonicity y portfolio payout x y r x r y portfolio pays deemed risky ii cash invariance m r r x m r x m adding non random cash portfolio reduces risk exactly iii positive homogeneity c 0 r cx cr x example double portfolio risk doubles iv subadditivity y portfolio payout r x y r x r y diversified portfolio x y risk exceed x y taken separately 22for products illiquid determined risk model price product 19 vega protocol 6 network risk margin evaluation maintenance margin closeout vega protocol use coherent risk measure scaled parameter 0 1 parameter adjusted ensure collateral insurance pool doesnt depleted doesnt grow size appropriate market trader open positions value x future time t 0 choose risk factor equation 1 maintenance m rl x maintenance risk inherent liabilities given m exceeds mamount collateral given participant risk universe probability network risk high justify initiating close trade reduce risk trade closed rl x mmaintenance m 2 mmaintenance maintenance margin margin traders account left closeout trade executed transferred network insurance pool protect participants unwanted closeouts network offer user configurable asearch 0 maintenance mamount 1 asearch mmaintenance m 3 network attempt allocate collateral risk universe section 4 4 collateral allocated position closed 2 satisfied initial margin market parameter specify ainitial asearch minimum collateral required new trade entered initial margin initial 1 ainitial mmaintenance m maintenance having initial margin level minitial higher margin search level 1 asearch m ensures small negative price wont lead situation network attempt allocate collateral risk universe immediately trade entered coherent risk measures versus value risk coherent risk measures basis margining means risk calculation robust theoretically sound subadditivity property coherent risk measures means net margin requirements different markets use expected shortfall es risk measure margin calculations average value risk var es r v x representing payoff portfolio 0 1 z l 1 esl x vara x da 4 0 var defined minimum x p x x 0 smaller vara x inffx r p x x 0 note approaches margin calculations particular note isda simm approach 17 24 believe approach robust dealing correlations lack knowledge correlation coherent risk measure contrast isda simm model uses value risk subadditive overcome correlation matrix calibrated assumption risk factors 20 vega protocol 6 network risk margin level network risk categorisation 8 1 ainitial mmaintenance sufficient enter position financial risk network 1 ainitial mmaintenance 1 asearch mmaintenance financial risk network 1 asearch mmaintenance maintenancemcollateral search zone 3 maintenancem 0 closeout zone 2 acceptable probability loss figure 9 collateral categorisation risk trades jointly normal reason isda simm model designed simple intended non cleared derivatives means counterparty implementation data sets run model vega networks issue arise network nodes run risk models behalf participants vega use expected shortfall 4 basis margin calculations value risk building block expected shortfall vega use risk measure right finally models robust important use appropriate stochastic models particular volatility parameters set conservatively models imply fat tailed time marginal distributions 16 details models calculations vega network 29 6 2 liquidity risk ability markets remain functional fairly priced dependent things23 presence sufficient liquidity relative trading volume open interest liquid markets allow participants best chance trading fair price absorb new information faster susceptible extreme price moves flash crashes vegas decentralised environment illiquidity bigger problem impacts risk models 4 lead erroneous margin requirements jeopardises ability position resolution algorithm section 5 3 execute closeout trades participants close default section 6 1 increasing risk loss network furthermore closeout trades occur likely price substantially low liquidity environment trigger extreme price protection section 6 3 event buy sell order book volume insufficient close largest single counter position held trader market suspended section 5 1 market reopened provision additional liquidity market makers traders meets requirement aim mechanism ensure allowing markets behaviour 23including presence informed traders arbitrageurs timely dissemination relevant information 21 vega protocol 6 network risk descend farce self reinforcing cascade closeouts larger price moves situation arrested untenable trading settlement occurs24 market viable protects traders open positions unnecessary closeouts position resolution makes likely new buyers sellers enter market allow trading resume example market awaiting announcement cause step shift price causing order book depth reduce traders await outcome trigger market suspension news received order book volume recovers sufficiently reopen market 6 3 extreme price moves circumstances instruments price diverge unacceptably fair market price likely happen illiquid markets exacerbated interactions automated trading systems react large price moves way reinforces creates need monitor react extreme price moves particularly given fully automated nature trading vega requirement close positions unacceptably high risk default section 6 1 creates additional potentially amplifying force closeout trades created position resolution section 5 3 likely happen times market disruption experience trading venues tells failure properly react events create negative outcomes participants trading venue protocol includes circuit breaker designed ensure market price moves reflective true supply demand circuit breaker triggered event change price open market deemed excessive25 excessive mean price likely artefact market microstructure reflecting genuine market excessive determined risk model view likelihood given price network parameter specifying exact threshold markets risk model needed margins protocol use assumption price moves normally distributed determine standard deviation historical price data rolling window triggering circuit breaker market transitioned auction section 5 1 pre defined length price resulting auction uncrossing deemed fair price market returns normal trading mode goal monitoring intervention prevent large valid price moves ensure fairest possible price achieved giving market participants time respond extreme price action example large sell order initiate significant downward price swing lot orders near best bid place market including large sell order auction buyers enter market reaction low indicative uncrossing price 6 4 insurance pool market section 3 4 insurance pool utilised layer collateral protection case shortfall closing distressed trades insurance pool market contain funds market created gain funds time trading activity markets mature release insurance pool funds section 4 section 6 1 explained traders position closed position resolution algorithm section 5 3 collateral assigned risk universe section 3 5 falls level required risk model virtue fact remaining collateral allocated risk universe position held network 24unless instrument reaches maturity suspended settlement performed usual rules 25note use words circuit breaker triggered instead executing trades breach market limits prevent anomalous price reached 22 vega protocol 6 network risk position resolution invoked closeout trade result profit loss network question depending slippage experienced closeout trade closeout trade remaining collateral allocated risk universe added insurance pool loss making closeout trade funded insurance pool mechanism confiscate funds designed ensure insurance pool grows time deterrent collateral mis management insurance pool funded case trader attempts double spend collateral section 6 1 penalties applied market maker doesnt fulfil obligations section 7 2 funds left insurance pool good loss making closeout trade step 5 position resolution algorithm triggered manage socialisation loss section 5 3 expiry order book final settlement market closed governance action section 8 3 insurance pool distributed markets base currency volume weighted relative open interest market suspended insurance pool remains market market expires closed markets base currency insurance pool remain available period time network parameter suggested months attributed market successfully created base currency market created insurance pool proceeds divided networks node operators relative stake conclusion waiting period 6 5 risks decentralisation proof stake markets vega exposed traditional forms market manipulation traditional centralised exchanges suffer decentralised nature vega networks creates new ways gaming system transparency transactions mechanics consensus protocol mitigated design protocol mechanics inclusion protective logic possible subverts consensus mechanism potentially obtain funds held users margin accounts market maker stakes funds network insurance pools safety consensus algorithms scope section proof stake consensus algorithms area active research vega wider blockchain community accumulates sufficient stake control outcome consensus algorithm potentially control funds margin accounts insurance pools follows theoretical minimum value crypto assets proof stake total value collateral attacker access reduced inclusion mechanisms restrict withdrawal funds ensure funds depleted slowly ongoing area research vega depending exact consensus mechanism algorithm implemented point time node known lead node know definite list proposed transactions block rise opportunities running vega researching number mechanisms prevent broadly focus approaches lead node chosen hard predict fashion changed frequently making chance profit hard realise known commit reveal based cryptographic methods involves submitting transactions step process participants submit binding transactions encrypted secret sharing algorithm 1 invisible participants lead node proposes ordered list transactions participants intentions scope running participants finally submit keys decrypt transactions second step nodes execute transactions method impacts latency likely usable markets discrete trading section 5 1 23 vega protocol 6 network risk 6 6 market manipulation gaming aim work design trading protocol provides participants opportunities profit trading leads fair efficient markets addition exploiting decentralised nature vega networks ways game protocol manipulate markets prices market manipulation takes forms broadly speaking deliberate attempt interfere free fair operation market benefit artificially created price moves category broadly distinguish types gaming manipulation nefarious participant try manipulate settlement process section 5 2 feeding node incorrect information benefits said participant directly attempt benefit rules vega protocol instance closes trades section 5 3 protects illiquidity section 6 2 extreme price moves section 6 3 incentivises penalises market makers section 7 settlement based data local market vega network oracles case settlement based local market opportunity attempt shift price trading general attack avoided products reference deep liquid markets source settlement data getting oracle provide false data theoretically possible mitigated proven reliable oracles provide cryptographically signed data feeds multiple oracle sources algorithm makes manipulation harder e g remove outliers average rest 2 finally mitigate attacks settlement vega network enforce cooling period settled funds released augmented mechanism running settlement manipulation observed corrected question position resolution section 5 3 attacked essentially boils position resolution algorithm create arbitrage26 clear possible source arbitrage margin level closeout initiated section 6 1 set low allowing participant trade risky fashion walking away losing positions pocketing gains clearly prevented setting risk parameters closeout level conservatively moment authors aware theoretical methods allow set correct level determined simulation possible attack vector market manipulation participant position benefit participant closed position resolution algorithm situation needs research testing models capture behaviour trading limit order books 23 serve starting point approach simulate situations test network note market manipulation prevented application trading price limits section 6 3 calculated limits account instruments volatility open interest limits restrict single order trade size maximum allowable price single order triggering auction likely prevent egregious price 27 market maker orders automatically posted refreshed theoretically possible nefarious participant advantage careful design testing exactly happens minimise potential abuse classical forms market manipulation e g wash trading28 possible vega market mitigated having deep liquid markets vega protocol designed ground provide markets believe careful research design testing considered bootstrapping possible prevent market abuse 26there ways define arbitrage formulation arbitrage self financing trading strategy guaranteed produce loss strictly positive probability turning profit allowing unlimited exposure general free lunch vanishing risk 11 27calculation methodologies limits tested details provided later date 28since vega protocol identifies participants public key possible traders hold multiple accounts trade wash trade wash trading requires separate transactions submitted distributed network guarantee trader trade participant cost trader fees transaction 24 vega protocol 7 liquidity 7 liquidity unlike centrally managed markets operators profits derived largely trading volume entirely peer peer trading venue natural incentives individual party source liquidity creates bootstrapping problem low volume markets unprofitable market makers resulting lack depth restricts growth trading attract market making activity 3 21 10 simplest solution protocol include fee payable organisation tasked attracting liquidity disadvantages view unworkable given goals discussed section 2 introduces unacceptable centralisation organisation question allowing favour markets effectively censor controlling provision liquidity organisation bottleneck launch new markets severely compromise ideal permissionless market creation eventually rise large bureaucratic operation liable misallocate resources lose nimble ecosystem based alternatives achieve design goals requires incentivisation market making built protocol caters markets different trading volumes different points lifecycle achieved facilitation protocol level dynamically priced liquidity recognises market making capital intensive aims market driven solution efficiently balances need order book depth hand preference low fees remainder section describes role market makers mechanics liquidity incentivisation vega protocol detail 7 1 mechanics liquidity marketplace vega essence peer peer liquidity facilitation protocol liquidity able priced 10 individually market section 7 3 liquidity fee incurred quantity determined volume price potential trade markets current liquidity price aggressive price taking order trades situations auctions section 5 1 maker taker relationship counterparties cost liquidity shared equally liquidity cost later credited settlement participants responsible provision liquidity market price maker markets infrastructure operators market makers price maker infrastructure operators receive appropriate amounts remainder divided instruments market makers relative allocations based individual contributions order book liquidity29 market making volume valuable market competitively priced consequently relative allocations market makers liquidity reward takes historical pricing account market makers choice deploy capital rationally select markets offer highest potential liquidity returns investment horizon liquidity returns depend trading volume share liquidity rewards liquidity price calculated terms base currency market liquidity pricing protocols mechanism ensure liquidity attracted markets greatest need markets operate efficient costs participants 29specific calculations values calibration covered future work 25 vega protocol 7 liquidity 7 2 role market makers electing market maker enables participants rewarded value create providing committed liquidity markets receiving share proceeds liquidity transactions entire market mechanic designed requirement minimum market making commitment create new market incentivise market makers act owner operators markets key way vega protocol aims create thriving ecosystem earn market making rewards participant deposit financial stake elected market known market making stake funds held network base currency market size stake determining minimum volume market maker deploy market order book rewards calculated according total volume traded market like centralised exchange percentage reward individual market maker receives depending market making stake relative total price making activity active competitive prices receive greater rewards 30 longevity market making commitment limit market making stake market accept vega participant wishes market maker able instruments total market making stake deemed instruments comfortable minimum stake31 market making stake withdrawn market maker wishing resign market making reduce commitment active market making requires participant actively manage pricing strategy market making volume market making orders threshold specified market parameter traded price actively priced market maker minimum percentage time network parameter initially proposed 80% market maker orders auto refreshed network competitive price threshold32 market maker minimum obligated volume present buy sell order book penalised act set price volume meet active pricing requirements market maker update volume orders higher commitment need price orders frequently passive market making hand allows participants support market provide liquidity need actively prices risk manage portfolio positions passive market making collateral automatically deployed supply liquidity algorithmically based prices posted market makers passive market makers share market making reward active market makers meaning rewards commensurately lower lighter effort required note markets creator passive market maker threshold minimum active market making stake ensure significant active presence pricing orders financial stake market maker held bond fulfilment market obligations market makers provide sufficient capital support minimum margin requirement derived continuous provision liquidity addition open positions whilst network refresh market maker orders obligation remains market maker ensure orders accepted network section 6 1 orders accepted market maker penalised failed place order active market makers penalised fall threshold percentage time required actively price orders 30this calculated historical price volume activity weighting recent activity highly 31taking account instrument volatility open interest total market making stake 32this prevents market maker penalised having orders traded away 26 vega protocol 7 liquidity specifically portion market makers stake transferred insurance pool penalty based scale failure meet commitments ii portion market makers stake forcibly utilised collateral necessary fund order book obligations 33 market contains sufficient market making stake permit market maker resignations commitment reduced instead liquidity supplycost liquidityhigh cost liquidity attracts market makers low cost liquidity encourages trading figure 10 illustrative example liquidity pricing curve 7 3 dynamic liquidity pricing efficient market liquidity price capture marginal benefit attracting order book depth define increase trading volume result incremental additional liquidity exogenous demand product price point difficult measure displayed order book endogenous demand vega network existence closeout trades provides useful lower bound value additional liquidity liquidity price point time liquidity price function factors open interest market order book depth observed trading volume current market making stake markets open interest captures maximum endogenous demand point time order book depth trading volume calibrate relative size unit additional liquidity current market making stake tells guaranteed supply liquidity area ongoing research results shared vega xyz absence work usefully examine liquidity price dynamics balance supply demand closed system vega network naturally demand liquidity increases drive price market increased need liquidity 33the reallocated depends market makers commitment versus collateral shortfall 27 vega protocol 7 liquidity high credit risk increases open interest market increases relative order book depth protocol relies ability immediately offload market risk distressed position participant follows positions measured open interest potentially distressed positions ceteris paribus higher level order book depth required given level safety ii low trading volume reduction demand instrument regardless pricing market uncompetitive price accessible volume cases attracting market makers beneficial increase available volume likely improve prices provoking competition market makers conversely highly liquid market high churn trading volume reduced need market makers cost liquidity decreases accordingly market makers benefit high volume liquidity payments traders benefit lower liquidity price capture contributing factors liquidity pricing curve derived market initially develop naive workable pricing model improved time application ongoing research analysis empirical data figure 10 shows illustrative liquidity curve captures aforementioned price dynamics note liquidity price single percentage value e g 0 01% total liquidity reward trade calculated percentage trades value notional volume premium liquidity prices adjusted periodically balance need capture changing market dynamics benefit stable pricing time updates market network parameter order day 28 vega protocol 8 decentralised governance 8 decentralised governance vega designed run centralised human intervention operational governance defined rules embedded code allowing permissionless instrument creation unlimited horizontal scalability network governance vega intended replace forms governance public vega ecosystem34 specifically provide chain governance key functions required create maintain high quality functioning markets decentralised environment 8 1 stake weighted voting primary chain governance mechanic vega voting network participants based stake scope poll example network governance issues like creation new market determination network parameters stake measured terms participants holding networks native crypto asset 28 governance asset ii market governance decisions stake measured notional value participants net position market making stake combination crypto asset allocated risk universe fees trading collateral considered held network participant counted participants votes cases network vote default option weight assets assets held vega network allocated risk universe included participants stake votes participant vote way given poll deemed voted available stake35 required majority decision minimum participation defined type poll 2 3 majority 0% minimum participation36 standard votes requiring certain non zero participation level proposer forfeit staking asset minimum required participation level reached measure place ensure proposal spam cost governance proposals create vector liveness attacks order remove incentive malicious behaviours voter bribery potential introduce secret ballots chain governance voting principles homomorphic encryption secure electonic elections technologies 15 14 8 2 market creation open markets vega proposed unlisted instrument e instrument active open market participant holding positive balance staking asset section 8 1 proposed markets base currency committed market making stake section 7 2 proposal specify tradable instrument including product product parameters risk model risk parameters trading mode market parameters section 3 size participants market making commitment market making stake section 7 2 proposals visible participants successfully complete process described market tradable 34for example development reference vega implementation ongoing development smart product language suite risk models margining occur offline 35if reason participant wishes vote stake support multiple options vote need transfer stake different wallet 36this implies example markets created proposer votes 29 vega protocol 8 decentralised governance new instrument proposed vega network potential new market enters proposal period sufficient market making stake immediately committed allow network ensure market meets communitys standards proposer hold positive governance asset market proposal deemed vote favour markets creation commitment market making section 7 2 stakeholders vote market remain pending proposal period network parameter suggested length days participants vote proposal reason include use incorrect badly worded fraudulent market parameter poor choice risk model risk parameters proposed market similar market37 proposal unethical market concerns accuracy trustworthiness oracles voter prefer market use different trading mode voter prefers different proposal similar market instrument remain pending indefinitely minimum market making stake met period participants join proposer potential market maker instrument way market proposer revoke proposal voting revoked proposal deemed cancelled market created regardless market making commitment38 conclusion proposal period39 market created sufficient collateral allocated market making stake votes won market exits proposal period tradable instrument considered listed instrument market starts accept orders new markets launch auction period transitioning defined normal trading mode 8 3 market closure rare circumstances preferable close market allow continue trading case market later found fraudulent failure major disruption external price source ethical reasons closed market cease trading settle open positions immediately opting settle open trades placed price time closure choice method proposed voted market participants irrevocable nature market closure potential reputational impact majority required close market minimum participation needed significantly higher votes 8 4 parameter changes voting update configurable parameters vega network proposals form parameter proposed value expiry time effective time new parameter taking effect effective time proposal approved expiry time 37for example exactly underlying different price source similar different underlying assets brent crude vs wti oil reason rejection 38this necessary ensure markets created information asymmetry proposer discovers issue prevent market going ahead hard spot e g bug smart product issue external data source 39the maximum length proposal period indefinite depends time taken attract sufficient market making stake achieve required majority votes 30 vega protocol 9 future work future work whilst paper sets coherent believe compelling vision fully permissionless trust minimising smart products layer augment nascent decentralised financial system complete technical specification leaves open implementation details specifics topics listed focus vega work bring concept life smart product language design smart product language associated risk models framework active research subject detailed paper course staking economics proof stake networks economics subject interest research vega blockchain community general observe actively involved determining run secure trading network proof stake dynamic liquidity pricing actively working methodology better quantify value liquidity realistic market scenarios goal improving liquidity pricing algorithm vega risk scenario testing order gain confidence quality correctness protocol design implementation vega perform publish results extensive testing addition conducting research risks inherent platform engage parties audit test code open source plan release reference implementation vega open source project transition development foundation medium long term set timelines commitments time writing consensus protocol currently tendermint consensus layer evaluating alternatives process ongoing goal improving performance security stability vega 31 vega protocol glossary glossary auction period time auction open receive bids offers auction uncrossing occur determine trades created 15 auction uncrossing algorithm generates trades conclusion auction processing price time priority set crossed orders maximises traded volume trades occur price range allowed limit prices trading orders calculated price determination algorithm use market parameter 15 22 base currency currency crypto asset orders priced settlement margining given market 23 25 26 29 coherent risk measure function r assigns real number risk random variable portfolio risk measure called coherent satisfy monotonicity cash invariance positive homogeneity subadditivity section 6 12 1 10 19 20 continuous trading trading mode uses limit order book match trades price time priority new amended orders immediately evaluated order crosses orders e best buy price greater equal best sell price trades generated 2 10 discrete trading trading mode prices determined frequent batch auctions 19 traders submit orders time held trading market constantly auction period regular auction uncrossings occurring end discrete period 2 10 23 distressed position open position held trader net combined value current margin requirements outstanding settlement cashflows greater available collateral given asset section 5 3 1618 28 indicative uncrossing price point auction period price auction uncross auction ended point 15 22 indicative uncrossing volume point auction period volume trades executed uncrossing auction ended point 15 initial margin minimum collateral available risk universe required new trade section 6 1 13 20 instrument product parameters required settlement particular underlying base currency example btc usd dec 2019 future contrast tradable instrument section 3 3 1 2 insurance pool capital associated market complete settlement rare case shortfall closing distressed positions market insurance pools funded allocated collateral remains closing distressed positions normal case markets base currency closed insurance pools redistributed section 6 4 2 13 17 20 22 23 27 maintenance margin minimum collateral available risk universe required trades forcibly closed section 6 1 13 20 market maker trader commits engage market making placing stake markets receives share market making rewards market section 7 2 13 5 10 16 2428 30 32 vega protocol glossary market parameter parameter vega network applies given market different market generally set market creation modified governance vote section 3 section 8 4 10 14 15 29 network parameter parameter vega network applies network market modified governance vote section 3 section 8 4 8 22 23 26 30 open market publicly visible market participant sufficient collateral trade market maker open markets created protocols governance processes section 3 section 8 2 2 15 16 22 29 oracle definite external source price information relevant data calculation settlement cashflows risk margins section 3 2 3 9 24 30 counter trade occurs parties open market example request quote matched trades section 5 1 2 10 15 16 position resolution methodology distressed positions settled closing deleveraging market positions section 5 3 2 1618 2124 product parameter parameter required product order fully specified product plus required parameters known instrument section 3 2 9 29 proof stake method securing decentralised byzantine fault tolerant systems sybil attacks weighting vote consensus protocol proportionally holding specific crypto asset 1 23 request quote counter trading mode participant signals market interest trading specific instrument given size participants free provide price quote certain period time end period trades created participant chooses accept quotes provided 2 10 16 risk model stochastic model calculate required margin relevant risk numbers given product section 6 1 1 2 9 10 18 19 22 29 30 risk parameter parameter required risk model order calculate margin risk numbers product instrument required risk parameters known tradable instrument section 3 2 10 29 30 risk universe collection order books related products risk netted example futures risk universe consist order books different maturity dates european options risk universe contain order books given underlying exercise date range strikes 10 12 13 17 18 20 22 23 29 sharding method scaling software splitting work multiple servers networks shards way work network touches shards vega protocol designed shardable risk universe risk universe operates independently risk universe margin requirements depend participants position constituent markets 8 12 smart product type smart contract specify behaviour products traded vega network smart products written domain specific language dsl designed financial products specify things products inputs product parameters calculate settlement cashflows information smart products provided future paper published vega xyz 1 2 9 30 31 smart product language language creating smart products 7 2 9 29 33 vega protocol glossary tradable instrument instrument risk model required parameters risk margin calculations specified 10 19 29 30 trading mode set rules use given open counter market specified market parameter section 5 1 2 10 14 22 29 30 underlying asset index data point gives derivative value 1 9 10 30 34 vega protocol references references 1 s adi share secret communications acm 22 11 612613 1979 2 d dolev n lynch s s pinter e w stark w e weihl reaching approximate agreement presence faults jacm 33 3 499 516 1986 3 s j grossman m h miller liquidity market structure journal finance 43 3 617633 1988 4 j muranaga m ohsawa measurement liquidity risk context market risk calculation institute monetary economic studies bank japan 1997 5 p artzner f delbaen j m eber d heath coherent measures risk mathematical finance 9 3 1999 6 m castro b liskov practical byzantine fault tolerance proceedings symposium operating systems design implementation 1999 7 s p jones j m eber j seward composing contracts adventure financial engineering oliveira j n zave p eds fme 2001 formal methods increasing software productivity springer 2001 8 j hull options futures derivatives prentice hall 2002 9 p glasserman monte carlo methods financial engineering springer 2004 10 g c chacko j w jurek e stafford pricing liquidity quantity structure immediacy prices harvard business school working paper 2006 11 f delbaen w schachermayer mathematics arbitrage birkhauser 2006 12 h follmer schied convex coherent risk measures https www math hu berlin de foellmer papers ccrm pdf 2008 13 t bjork arbitrage theory continous time oxford university press 2009 14 d chaum m jakobsson r l rivest p y ryan j benaloh m kutylowski b adida eds trustworthy elections new directions electronic voting springer 2010 15 kiayias m yung tree homomorphic encryption scalable hierarchical secret ballot elections proceedings international conference financial cryptography data security 257271 2010 16 s v stoyanov s rachev b racheva iotova f j fabozzi fat tailed models risk estimation journal portfolio management 37 2 2011 17 isda standard initial margin model non cleared derivatives https www isda org cgdde simm non cleared 20131210 pdf 2013 18 j kwon tendermint consensus mining https cosmos network resources whitepaper 2014 19 e budish p crampton j shim high frequency trading arms race frequent batch auctions market design response q j econ 130 4 15471621 2015 20 m broadie y du c c moallemi risk estimation regression operations research 63 5 10771097 2015 21 k malinova park subsidizing liquidity impact fees market quality journal finance 70 2 509536 2015 22 m musiela m rutkowski martingale methods financial modelling springer 2015 35 vega protocol references 23 f abergel m anane chakraborti jedidi m toke limit order books cambridge university press 2016 24 isda simm methodology version 2 0 https www isda org cgdde simm non cleared 20131210 pdf 2017 25 d ska risk neutral asset pricing si http www maths ed ac uk dsiska rnap notes pdf 2017 26 t zhang l wang decentralized dark pool exchange providing atomic swaps ethereum based assets bitcoin republic protocol white paper https releases republicprotocol com whitepaper 1 0 0 whitepaper 1 0 0 pdf 2017 27 e posner e weyl radical markets uprooting capitalism democracy society princeton university press 2018 28 b mannerings vega token peer peer tradable liquidity vega white paper released 2019 29 d ska market risk management distributed anonymous exchange vega research si paper released 2019 36